<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>iCamera AI - iOS 26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            overflow: hidden; 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
        }

        .glass-blur {
            background: rgba(10, 10, 10, 0.4);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
        }

        .shutter-outer {
            width: 80px;
            height: 80px;
            border: 4px solid #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }

        .shutter-inner {
            width: 66px;
            height: 66px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.1s;
        }

        .shutter-outer:active .shutter-inner {
            transform: scale(0.9);
        }

        .focus-box {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 1.5px solid #FFD60A;
            pointer-events: none;
            z-index: 40;
            transition: opacity 0.3s;
        }

        .ev-line {
            position: absolute;
            left: 95px;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 120px;
            background: rgba(255, 214, 10, 0.3);
        }

        .ev-sun {
            position: absolute;
            left: -9px;
            color: #FFD60A;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .scan-ai {
            width: 100%;
            height: 2px;
            background: #3b82f6;
            position: absolute;
            z-index: 100;
            box-shadow: 0 0 15px #3b82f6;
            animation: scan 1.5s linear infinite;
        }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Smooth Slider Zoom */
        .zoom-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.2);
            border-radius: 1px;
            outline: none;
        }
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [isCamActive, setIsCamActive] = useState(false);
            const [zoom, setZoom] = useState(1);
            const [ev, setEv] = useState(0);
            const [flash, setFlash] = useState(false);
            const [focusPos, setFocusPos] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            const [enhancedImg, setEnhancedImg] = useState(null);
            const [status, setStatus] = useState('');

            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const trackRef = useRef(null);
            const startY = useRef(0);
            const startEv = useRef(0);
            
            const apiKey = ""; 

            const initCamera = async () => {
                setStatus('Membuka Kamera...');
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment', width: { ideal: 3840 }, height: { ideal: 2160 } },
                        audio: false
                    });
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        trackRef.current = stream.getVideoTracks()[0];
                        setIsCamActive(true);
                        setStatus('');
                    }
                } catch (err) {
                    setStatus('Gagal: Kamera tidak diizinkan.');
                }
            };

            // Hardware sync
            useEffect(() => {
                if (trackRef.current) {
                    trackRef.current.applyConstraints({
                        advanced: [{ torch: flash, exposureCompensation: ev }]
                    }).catch(() => {});
                }
            }, [flash, ev]);

            const handleTouchStart = (e) => {
                if (!isCamActive) return;
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                
                setFocusPos({ x, y });
                startY.current = e.touches[0].clientY;
                startEv.current = ev;

                // Auto hide focus box
                setTimeout(() => setFocusPos(null), 5000);
            };

            const handleTouchMove = (e) => {
                if (!focusPos) return;
                const currentY = e.touches[0].clientY;
                const diff = (startY.current - currentY) / 100; // Sensitivity
                
                setEv(prev => {
                    const next = startEv.current + diff;
                    return Math.max(-2, Math.min(2, next));
                });
            };

            const capture = async () => {
                if (isProcessing || !isCamActive) return;
                
                const video = videoRef.current;
                const canvas = canvasRef.current;
                if (!video || !canvas) return;

                const ctx = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                // Crop logic for 20x zoom
                const sw = video.videoWidth / zoom;
                const sh = video.videoHeight / zoom;
                const sx = (video.videoWidth - sw) / 2;
                const sy = (video.videoHeight - sh) / 2;

                ctx.filter = `brightness(${1 + (ev * 0.15)})`;
                ctx.drawImage(video, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);
                
                const b64 = canvas.toDataURL('image/png').split(',')[1];
                setIsProcessing(true);

                try {
                    // Pakai gemini-2.5-flash-image-preview untuk image-to-image enhancement
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: "Enhance this zoomed photo. Reconstruct lost pixels, sharpen edges, and remove digital noise. Make it look like a clear high-resolution photo. Return only the enhanced image." },
                                    { inlineData: { mimeType: "image/png", data: b64 } }
                                ]
                            }],
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                        })
                    });

                    const data = await response.json();
                    const aiImageB64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    
                    if (aiImageB64) {
                        setEnhancedImg(`data:image/png;base64,${aiImageB64}`);
                    }
                } catch (e) {
                    console.error(e);
                } finally {
                    setIsProcessing(false);
                }
            };

            return (
                <div className="h-screen w-screen flex flex-col bg-black relative select-none">
                    
                    {/* Startup Screen */}
                    {!isCamActive && (
                        <div className="absolute inset-0 z-[100] bg-black flex flex-col items-center justify-center p-12 text-center">
                            <div className="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mb-8 border border-white/10">
                                <i data-lucide="camera" className="text-white" size={32}></i>
                            </div>
                            <h1 className="text-xl font-bold mb-2">iCamera AI</h1>
                            <p className="text-xs text-zinc-500 mb-10 leading-relaxed">Ketuk tombol di bawah buat ngaktifin kamera iOS 26 lu.</p>
                            <button 
                                onClick={initCamera}
                                className="w-full max-w-xs bg-white text-black font-black py-4 rounded-2xl active:scale-95 transition shadow-2xl"
                            >
                                {status ? status : "ACTIVATE CAMERA"}
                            </button>
                        </div>
                    )}

                    {/* Viewfinder */}
                    <div 
                        className="flex-1 relative overflow-hidden flex items-center justify-center"
                        onTouchStart={handleTouchStart}
                        onTouchMove={handleTouchMove}
                    >
                        <video 
                            ref={videoRef} autoPlay playsInline muted 
                            className="absolute w-full h-full object-cover"
                            style={{ 
                                transform: `scale(${zoom})`,
                                filter: `brightness(${1 + (ev * 0.1)})`
                            }}
                        />

                        {/* Focus & EV Anywhere Logic */}
                        {focusPos && (
                            <div 
                                className="focus-box"
                                style={{ top: focusPos.y - 40, left: focusPos.x - 40 }}
                            >
                                <div className="ev-line">
                                    <div 
                                        className="ev-sun"
                                        style={{ bottom: `${((ev + 2) / 4) * 100}%` }}
                                    >
                                        <i data-lucide="sun" size={16}></i>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Grid */}
                        <div className="absolute inset-0 pointer-events-none opacity-20 flex">
                            <div className="flex-1 border-r border-white/40"></div>
                            <div className="flex-1 border-r border-white/40"></div>
                            <div className="flex-1"></div>
                            <div className="absolute inset-0 flex flex-col">
                                <div className="flex-1 border-b border-white/40"></div>
                                <div className="flex-1 border-b border-white/40"></div>
                                <div className="flex-1"></div>
                            </div>
                        </div>

                        {/* AI Scanning */}
                        {isProcessing && (
                            <div className="absolute inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center">
                                <div className="scan-ai"></div>
                                <p className="text-blue-400 font-bold tracking-[0.4em] uppercase text-[10px] animate-pulse">Neural Enhancing</p>
                            </div>
                        )}
                    </div>

                    {/* Top Controls */}
                    <div className="absolute top-0 w-full z-40 safe-top px-6 py-4 flex justify-between items-center bg-gradient-to-b from-black/80 to-transparent">
                        <button onClick={() => setFlash(!flash)} className={flash ? "text-yellow-400" : "text-white"}>
                            <i data-lucide={flash ? "zap" : "zap-off"} size={22}></i>
                        </button>
                        <div className="flex items-center gap-2">
                             <div className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                             <span className="text-[9px] font-bold tracking-widest text-white/60 uppercase">NEURAL LIVE</span>
                        </div>
                        <div className="w-6"></div>
                    </div>

                    {/* Bottom Panel - iOS 26 Design */}
                    <div className="glass-blur safe-bottom flex flex-col items-center">
                        
                        {/* Zoom Picker */}
                        <div className="w-full flex flex-col items-center gap-2 pt-6 pb-2">
                            <div className="flex gap-6 text-[12px] font-bold text-white/50">
                                {[1, 2, 5, 10, 20].map(z => (
                                    <button 
                                        key={z} 
                                        onClick={() => setZoom(z)} 
                                        className={`transition-all ${zoom === z ? "text-yellow-400 scale-125 font-black" : ""}`}
                                    >
                                        {z}Ã—
                                    </button>
                                ))}
                            </div>
                            <div className="w-1/2 mt-4 px-4 opacity-30">
                                <input 
                                    type="range" min="1" max="20" step="0.1" 
                                    value={zoom} onChange={(e) => setZoom(parseFloat(e.target.value))}
                                    className="zoom-slider"
                                />
                            </div>
                        </div>

                        {/* Mode Bar */}
                        <div className="py-5">
                            <span className="text-yellow-400 font-black tracking-[0.2em] text-[11px] uppercase border-b-2 border-yellow-400 pb-1.5">Photo</span>
                        </div>

                        {/* Actions */}
                        <div className="w-full flex justify-around items-center px-10 pb-12">
                            <div className="w-12 h-12 bg-white/5 rounded-2xl border border-white/10 overflow-hidden">
                                {enhancedImg && <img src={enhancedImg} className="w-full h-full object-cover" />}
                            </div>
                            
                            <button onClick={capture} className="shutter-outer">
                                <div className="shutter-inner"></div>
                            </button>

                            <button onClick={() => initCamera()} className="w-12 h-12 flex items-center justify-center bg-white/5 rounded-full border border-white/10 active:rotate-180 transition-transform duration-500">
                                <i data-lucide="refresh-cw" size={22}></i>
                            </button>
                        </div>
                    </div>

                    {/* AI Result Viewer */}
                    {enhancedImg && (
                        <div className="fixed inset-0 z-[200] bg-black flex flex-col animate-in fade-in slide-in-from-bottom duration-300">
                            <div className="flex justify-between items-center p-6 pt-safe border-b border-white/5">
                                <span className="text-[10px] font-black tracking-widest text-blue-400 uppercase">AI SUPER RESOLUTION</span>
                                <button onClick={() => setEnhancedImg(null)} className="p-2 bg-white/10 rounded-full"><i data-lucide="x" size={22}></i></button>
                            </div>
                            <div className="flex-1 p-4 flex items-center justify-center overflow-hidden bg-zinc-950">
                                <img src={enhancedImg} className="max-w-full max-h-full rounded-3xl shadow-2xl object-contain" />
                            </div>
                            <div className="p-8 pb-safe-bottom bg-black">
                                <button className="w-full bg-blue-600 py-4 rounded-3xl font-black text-sm active:scale-95 transition shadow-xl shadow-blue-900/40">
                                    SAVE TO PHOTOS
                                </button>
                            </div>
                        </div>
                    )}

                    <canvas ref={canvasRef} className="hidden" />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // Load icons
        setTimeout(() => { if(window.lucide) window.lucide.createIcons(); }, 300);
    </script>
</body>
</html>

